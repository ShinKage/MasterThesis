\section{Counterpart model}

We now introduce the concept of \emph{counterpart model}, as in "counterpart theory" of David Lewis.

\begin{definition}
Let $\Sigma$ be a signature, and $\algset{A}$ the set of algebras over the signature $\Sigma$. A \emph{counterpart
model} $M$ is a triple $(W, \rightsquigarrow, d)$ such that:
\begin{itemize}
  \item $W$ is a set, representing worlds, i.e. points in time;
  \item $d : W \to \algset{A}$ is a function, assigning to each world $w \in W$ a $\Sigma$-algebra, $\algebra{A} \in
    \algset{A}$;
  \item $\rightsquigarrow\;\subseteq W \times (\algset{A} \rightharpoonup \algset{A}) \times W$ is the
    \emph{accessibility relation} over $W$, enriched with (partial) homomorphisms \emph{(counterpart relations)} between
  the algebras of the connected worlds, i.e. for every $(w_1, cr, w_2) \in\;\rightsquigarrow$ it must hold that $cr :
  d(w_1) \rightharpoonup d(w_2)$ is a (partial) homomorphism.
\end{itemize}
\end{definition}

As a shorthand notation, counterpart relations between two worlds in the accessibility relation, $(w_1, cr, w_2) \in
\rightsquigarrow$, will be also denoted as $\worldcr{w_1}{cr}{w_2}$.
The accessibility relation $\rightsquigarrow$ defines the counterparts in the target world of the source world,
effectively modeling the evolution of a system, modeled by the algebras, and avoiding the \emph{trans-world identity}
problem. Names are local to the belonging world, and components are identified across worlds only by the relation
between names instead of by a universal name. This, and partiality, allows for creation, deletion, renaming and merging
of elements in a type-preserving manner, however duplication is not permitted as counterpart relation are functions thus
can only associate a single element of the target world to an element of the source world.
In other terminology, the counterpart model can be seen as a generalisation of a \emph{graph transition system} where
transition are labelled with homomorphism between algebras, which are the state of the transition system and can be
arbitrarily complex within themselves.

For the rest of the work, we will implicitly assume that every counterpart model $M$ does not have deadlock worlds, i.e.
worlds without outgoing transitions. This condition is not a limitation since a counterpart model that does not satisfy
the condition can be transformed into one that does satisfy it by adding a reflexive transition to the accessibility
relation, i.e. for each $w$ that is a deadlock world, $(w, \text{id}_w, w) \in \rightsquigarrow$.

\begin{definition}
  Let $X$ be a denumerable sets of variables, and $M = (W, \rightsquigarrow, d)$ be a counterpart model over a signature
  $\Sigma$. A \emph{variable assignment} $\sigma$ for a world $w \in W$ is a (partial) function such that $\sigma : X
  \rightharpoonup d(w)$.
\end{definition}

Given a term $\epsilon \in \terms{\Sigma}{X}$ and an assignment $\sigma$, we will denote as
$\sigma(\epsilon)$ the lifting of $\sigma$ to the set $\terms{\Sigma}{X}$, i.e. applying the substition $\sigma$ to each
free variable in the term $\epsilon$. If any of the free
variables in $\epsilon$ are not in the domain of $\sigma$ than $\sigma(\epsilon)$ is undefined.

The set of of pairs $(\sigma, w)$ with $\sigma$ a variable assignment over the world $w$ in the counterpart model $M$ is
denoted as $\universe{}(M)$. When clear from context, we will omit the counterpart model. The set of pairs where the
domain of $\sigma$ is a subset of the first-order context $\Gamma$ will be denoted as $\universe{\Gamma}$.
Notice that a pair $(\sigma, w) \in \universe{\Gamma}$ may be undefined over some or all the elements of $\Gamma$,
addressing the need of modeling deallocation of items.
